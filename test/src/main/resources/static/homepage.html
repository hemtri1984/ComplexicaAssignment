<html>
<head>
    <link rel="stylesheet" href="style.css">
    <script src="./jquery-3.4.1.min.js">  </script>

    <script type="text/javascript">
        const baseUrl = "http://localhost:8085/";
        const columnHeadNames = ['Title', 'Customer Logo', 'Link'];

        function renderTableHead(columnHeadNames) {
            let head = '<thead><tr>';
            for (let i=0, length=columnHeadNames.length; i<length; i++) {
                head += '<th>' + columnHeadNames[i] + '</th>';
            }
            head += '</tr></thead>';
            return head;
        }

        function renderTableBody(data) {
            let body = '<tbody>';
            for (let i=0, length=data.length; i<length; i++) {
                body += '<tr>';
                body += '<td>' + data[i].label + '</td>';
                body += '<td><img height="74px" src="' + data[i].featuredImage + '" /></td>';
                body += '<td align="center" width="10%"><a href="' + data[i].url + '">Link</a></td>';
                body += '</tr>';
            }
            body += '</tbody>';
            return body;
        }

        function renderTable(headNames, bodyData) {
            let table = '<table border="1px">' + renderTableHead(headNames) + renderTableBody(bodyData) + '</table>';
            return table;
        }

        function getPostListing () {
            $.get(baseUrl + "post-list", function(data){
                $('#post-list-table').append($(renderTable(columnHeadNames, data)));
            }, "json");
        }

        function getWelcomeMsg() {
            $.get(baseUrl + "welcomes-msg",  function (data) {
                $('#welcome-msg').append("Hello, " + data);
            });
        }

        function getItineraryInfo(date) {
            if(date) {
                alert("Generating Itinerary Info of date: "+date);
            } else {
                alert("Please enter the date!");
            }
        }

        function addRow(tableID) {

            var table = document.getElementById(tableID);

            var time = "(3:00 PM)";

            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);

            var cell1 = row.insertCell(0);
            cell1.innerHTML = "City 1";
            var cell2 = row.insertCell(1);
            cell2.innerHTML = "Country 1";
            var cell3 = row.insertCell(2);
            cell3.innerHTML = "Country Code 1";
            var cell4 = row.insertCell(3);
            cell4.innerHTML = "Temperature 1" + time + ", Temperature 2"+time;
            var cell5 = row.insertCell(4);
            cell5.innerHTML = "Cloud 1";

        }

        function validateItineraryDate() {
            var today = new Date();
            var maxDay = new Date();
            maxDay.setDate(maxDay.getDate()+5);
            var dd = today.getDate();
            var ddmax = maxDay.getDate();
            var mm = today.getMonth()+1; //January is 0!
            var mmMax = maxDay.getMonth()+1;
            var yyyy = today.getFullYear();
            var yyyyMax = maxDay.getFullYear();
            if(dd<10){
                dd='0'+dd
            } 
            if(ddmax<10){
                ddmax='0'+ddmax
            } 
            if(mm<10){
                mm='0'+mm
            }
            if(mmMax<10){
                mmMax='0'+mmMax
            } 

            today = yyyy+'-'+mm+'-'+dd;
            maxdate = yyyyMax+'-'+mmMax+'-'+ddmax;
            document.getElementById("traveldate1").setAttribute("min", today);
            document.getElementById("traveldate1").setAttribute("max", maxdate);
            document.getElementById("traveldate2").setAttribute("min", today);
            document.getElementById("traveldate2").setAttribute("max", maxdate);
            document.getElementById("traveldate3").setAttribute("min", today);
            document.getElementById("traveldate3").setAttribute("max", maxdate);
        }

        function getTodayDate() {//Return today date in format of dd/mm/yyyy
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1;
            var yyyy = today.getFullYear();
            if(dd<10){
                dd='0'+dd
            } 
            if(mm<10){
                mm='0'+mm
            }

            today = yyyy+'/'+mm+'/'+dd;
            return today;
        }

        function getTodaysData(city) {
            /*$.get(baseUrl + "current",  function (data) {
                    $('#welcome-msg').append("Hello, " + data);
                });*/

                $.ajax({
                    type: "GET",
                    contentType: "application/json",
                    url: "/current",
                    headers: {"cityname": city1},
                    timeout: 60000,
                    success: function (data) {
                        
                    },
                    error: function (e) {
                        
                    }
                });
        }

        function getForecastData(city) {

        }

        function validateAndSubmitItinerary(city1, date1, city2, date2, city3, date3) {
            alert("Form submitted. City 1: "+city1+" Date1: "+date1+" City 2:"+city2+" date2: "+date2);
            var today = new Date();

            if(city1 && date1) {
                if(date1 === getTodayDate()) {//get today forecast

                } else {//get next 5 days forecast

                }
            }
        }

        function saveItinerary(city1, date1, city2, date2, city3, date3) {
            alert("Itinerary Saved")
            var table = document.getElementById("tb001");
            if (table.style.display === "none") {
                showTable();
            } else {
                hideTable();
            }
        }

        function hideTable() {
            var table = document.getElementById("tb001");
            table.style.display = "none";
        }

        function showTable() {
            var table = document.getElementById("tb001");
            table.style.display = "block";
        }

        function generateSummary() {
            alert("Generating Summary")
            addRow("tb002");
        }

        $(document).ready(function(){
            validateItineraryDate();
            //getWelcomeMsg();
            //getPostListing();
            });
    </script>

</head>
<body>
    <h1>Itinerary Form</h1>

    <form>
      <label for="cityname1">City Name:</label>
      <input type="text" id="cityname1" name="cityname" value="" required placeholder="First City Name">
      <label for="traveldate">Travel Date:</label>
      <input type="date" id="traveldate1" name="Travel Date" required><br/>
      <label for="cityname2">City Name:</label>
      <input type="text" id="cityname2" name="cityname" value="" placeholder="Second City Name">
      <label for="traveldate">Travel Date:</label>
      <input type="date" id="traveldate2" name="Travel Date"><br/>
      <label for="cityname3">City Name:</label>
      <input type="text" id="cityname3" name="cityname" value="" placeholder="Third City Name">
      <label for="traveldate">Travel Date:</label>
      <input type="date" id="traveldate3" name="Travel Date">
      <br/><br/><input type="submit" value="Submit" onclick="validateAndSubmitItinerary(document.getElementById('cityname1').value, document.getElementById('traveldate1').value, 
            document.getElementById('cityname2').value, document.getElementById('traveldate2').value, document.getElementById('cityname3').value, document.getElementById('traveldate3').value)">
      <input type="submit" value="Save Itineraty" onclick="saveItinerary(document.getElementById('cityname1').value, document.getElementById('traveldate1').value, 
      document.getElementById('cityname2').value, document.getElementById('traveldate2').value, document.getElementById('cityname3').value, document.getElementById('traveldate3').value)">
      <input type="button" value="Generate Summary" onclick="generateSummary()">
    </form>
    <br/><br/>
    <form>
      <input type="date" id="itineraryinfo" name="Date" required><br/>
      <input type="submit" value="Get Itinerary" onclick="getItineraryInfo(document.getElementById('itineraryinfo').value)">
    </form>
    <br/><br/>
    <div id="tb001"><table id="tb002" style="width:100%" border="1">
        <caption>Weather Results</caption>
        <tr id="tableheader">
          <th>City Name</th>
          <th>Country Name</th>
          <th>Country code</th>
          <th>Temperature</th>
          <th>Weather</th>
        </tr>        
      </table></div>

    <h1 id="welcome-msg" align="center">

    </h1>

    <div id="post-list-table" align="center">

</div>

</body>
</html>